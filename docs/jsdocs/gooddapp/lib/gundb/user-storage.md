<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

### Table of Contents

-   [GunDBUser][1]
    -   [Properties][2]
-   [FieldPrivacy][3]
-   [ProfileField][4]
    -   [Properties][5]
-   [FeedEvent][6]
    -   [Properties][7]
-   [TransactionEvent][8]
-   [getReceiveDataFromReceipt][9]
    -   [Parameters][10]
-   [UserStorage][11]
    -   [Parameters][12]
    -   [wallet][13]
    -   [gunuser][14]
    -   [profile][15]
    -   [feed][16]
    -   [feedIndex][17]
    -   [user][18]
    -   [ready][19]
    -   [init][20]
    -   [getFeedItemByTransactionHash][21]
        -   [Parameters][22]
    -   [getAllFeed][23]
    -   [updateFeedIndex][24]
        -   [Parameters][25]
    -   [initFeed][26]
    -   [getProfileFieldValue][27]
        -   [Parameters][28]
    -   [getProfileField][29]
        -   [Parameters][30]
    -   [getDisplayProfile][31]
        -   [Parameters][32]
    -   [getPrivateProfile][33]
        -   [Parameters][34]
    -   [setProfile][35]
        -   [Parameters][36]
    -   [setProfileField][37]
        -   [Parameters][38]
    -   [indexProfileField][39]
        -   [Parameters][40]
    -   [setProfileFieldPrivacy][41]
        -   [Parameters][42]
    -   [getFeedPage][43]
        -   [Parameters][44]
    -   [getFormattedEvents][45]
        -   [Parameters][46]
    -   [getUserAddress][47]
        -   [Parameters][48]
    -   [getUserProfile][49]
        -   [Parameters][50]
    -   [formatEvent][51]
        -   [Parameters][52]
    -   [enqueueTX][53]
        -   [Parameters][54]
    -   [dequeueTX][55]
        -   [Parameters][56]
    -   [peekTX][57]
        -   [Parameters][58]
    -   [updateFeedEvent][59]
        -   [Parameters][60]
    -   [getLastBlockNode][61]
    -   [saveLastBlockNumber][62]
        -   [Parameters][63]
    -   [deleteAccount][64]
    -   [maskField][65]
        -   [Parameters][66]
    -   [Parameters][67]

## GunDBUser

User details returned from Gun SEA

Type: {alias: [string][68], epub: [string][68], pub: [string][68], sea: any}

### Properties

-   `alias` **[string][68]** 
-   `epub` **[string][68]** 
-   `pub` **[string][68]** 
-   `sea` **any** 

## FieldPrivacy

possible privacy level for profile fields

Type: (`"private"` \| `"public"` \| `"masked"`)

## ProfileField

User's profile field data

Type: {value: EncryptedField, display: [string][68], privacy: [FieldPrivacy][69]}

### Properties

-   `value` **EncryptedField** 
-   `display` **[string][68]** 
-   `privacy` **[FieldPrivacy][69]** 

## FeedEvent

User's feed event data

Type: {id: [string][68], type: [string][68], date: [string][68], data: any}

### Properties

-   `id` **[string][68]** 
-   `type` **[string][68]** 
-   `date` **[string][68]** 
-   `data` **any** 

## TransactionEvent

Blockchain transaction event data

Type: any

## getReceiveDataFromReceipt

Extracts transfer events sent to the current account

### Parameters

-   `receipt` **[object][70]** Receipt event

Returns **[object][70]** {transferLog: event: [{evtName: evtValue}]}

## UserStorage

Users gundb to handle user storage.
User storage is used to keep the user Self Soverign Profile and his blockchain transcation history

### Parameters

-   `wallet` **GoodWallet** 

### wallet

wallet an instance of GoodWallet

Type: GoodWallet

### gunuser

a gun node refering to gun.user()

Type: Gun

### profile

a gun node refering to gun.user().get('profile')

Type: Gun

### feed

a gun node refering to gun.user().get('feed')

Type: Gun

### feedIndex

In memory array. keep number of events per day

Type: [Array][71]&lt;\[[Date][72], [number][73]]>

### user

object with Gun SEA user details

Type: [GunDBUser][74]

### ready

A promise which is resolved once init() is done

Type: [Promise][75]&lt;[boolean][76]>

### init

Initialize wallet, gundb user, feed and subscribe to events

### getFeedItemByTransactionHash

Find feed by transaction hash in array, and returns feed object

#### Parameters

-   `transactionHash` **[string][68]** transaction identifier

Returns **[object][70]** feed item or null if it doesn't exist

### getAllFeed

Returns a Promise that, when resolved, will have all the feeds available for the current user

Returns **[Promise][75]&lt;[Array][71]&lt;[FeedEvent][77]>>** 

### updateFeedIndex

Used as subscripition callback for gundb
When the index of <day> to <number of events> changes
We get the object and turn it into a sorted array by <day> which we keep in memory for feed display purposes

#### Parameters

-   `changed` **[object][70]** the index data from gundb an object with days as keys and number of event in that day as value
-   `field` **[string][68]** the name of the gundb key changed

### initFeed

Subscribes to changes on the event index of day to number of events
the "false" (see gundb docs) passed is so we get the complete 'index' on every change and not just the day that changed

### getProfileFieldValue

Returns profile attribute

#### Parameters

-   `field` **[string][68]** Profile attribute

Returns **[string][68]** Decrypted profile value

### getProfileField

Returns progfile attribute value

#### Parameters

-   `field` **[string][68]** Profile attribute

Returns **[Promise][75]** Gun profile attribute object

### getDisplayProfile

Return display attribute of each profile property

#### Parameters

-   `profile` **[object][70]** User profile

Returns **[object][70]** User model with display values

### getPrivateProfile

Returns user model with attribute values

#### Parameters

-   `profile` **[object][70]** user profile

Returns **[object][70]** UserModel with some inherit functions

### setProfile

Save profile with all validations and indexes
It saves only known profile fields

#### Parameters

-   `profile` **UserModel** User profile


-   Throws **any** Error if profile is invalid

Returns **[Promise][75]** Promise with profile settings updates and privacy validations

### setProfileField

Set profile field with privacy settings

#### Parameters

-   `field` **[string][68]** Profile attribute
-   `value` **[string][68]** Profile attribute value
-   `privacy` **[string][68]** (private | public | masked) (optional, default `'public'`)

Returns **[Promise][75]** Promise with updated field value, secret, display and privacy.

### indexProfileField

Generates index by field if privacy is public, or empty index if it's not public

#### Parameters

-   `field` **[string][68]** Profile attribute
-   `value` **[string][68]** Profile attribute value
-   `privacy` **[string][68]** (private | public | masked)

Returns **[Promise][75]&lt;ACK>** Gun result promise after index is generated

### setProfileFieldPrivacy

Set profile field privacy.

#### Parameters

-   `field` **[string][68]** Profile attribute
-   `privacy` **[string][68]** (private | public | masked)

Returns **[Promise][75]** Promise with updated field value, secret, display and privacy.

### getFeedPage

Returns the next page in feed. could contain more than numResults. each page will contain all of the transactions
of the last day fetched even if > numResults

#### Parameters

-   `numResults` **[number][73]** return at least this number of results if available
-   `reset` **[boolean][76]** should restart cursor (optional, default `false`)

Returns **[Promise][75]** Promise with an array of feed events

### getFormattedEvents

Return all feed events

#### Parameters

-   `numResults` **[number][73]** 
-   `reset` **[boolean][76]** 

Returns **[Promise][75]** Promise with array of standarised feed events

### getUserAddress

#### Parameters

-   `field` **[string][68]** Profile field value (email, mobile or wallet address value)

Returns **[string][68]** address

### getUserProfile

Returns name and avatar from profile based filtered by received value

#### Parameters

-   `field` **[string][68]** Profile field value (email, mobile or wallet address value)

Returns **[object][70]** profile - { name, avatar }

### formatEvent

Returns the feed in a standard format to be loaded in feed list and modal

#### Parameters

-   `param` **[FeedEvent][77]** Feed event with data, type, date and id props
    -   `param.data`  
    -   `param.type`  
    -   `param.date`  
    -   `param.id`  

Returns **[Promise][75]** Promise with StandardFeed object,
 with props { id, date, type, data: { amount, message, endpoint: { address, fullName, avatar, withdrawStatus }}}

### enqueueTX

enqueue a new pending TX done on DAPP, to be later merged with the blockchain tx
the DAPP event can contain more details than the blockchain tx event

#### Parameters

-   `event` **[FeedEvent][77]** 

Returns **[Promise][75]&lt;>** 

### dequeueTX

remove and return pending TX

#### Parameters

-   `eventId` **[string][68]** 
-   `event` **any** 

Returns **[Promise][75]&lt;[FeedEvent][77]>** 

### peekTX

lookup a pending tx

#### Parameters

-   `eventId` **[string][68]** 

Returns **[Promise][75]&lt;[FeedEvent][77]>** 

### updateFeedEvent

Update feed event

#### Parameters

-   `event` **[FeedEvent][77]** Event to be updated

Returns **[Promise][75]** Promise with updated feed

### getLastBlockNode

Returns the 'lastBlock' gun's node

Returns **any** 

### saveLastBlockNumber

Saves block number in the 'lastBlock' node

#### Parameters

-   `blockNumber` **([number][73] \| [string][68])** 

Returns **[Promise][75]&lt;([Promise][75]&lt;any> | [Promise][75]&lt;(R | any)>)>** 

### deleteAccount

Delete the user account.
Deleting gundb profile and clearing local storage
Calling the server to delete their data

Returns **[Promise][75]&lt;[boolean][76]>** 

### maskField

Returns phone with last 4 numbers, and before that \*\*\*,
and hide email user characters leaving visible only first and last character

#### Parameters

-   `fieldType` **[string][68]** (Email, mobile or phone) Field name
-   `value` **[string][68]** Field value

Returns **[string][68]** Returns masked value with \*\*\* to hide characters

## 

Clean string removing blank spaces and special characters, and converts to lower case

### Parameters

-   `field` **[string][68]** Field name
-   `value` **[string][68]** Field value

Returns **[string][68]** Value without '+' (plus), '-' (minus), '\_' (underscore), ' ' (space), in lower case

[1]: #gundbuser

[2]: #properties

[3]: #fieldprivacy

[4]: #profilefield

[5]: #properties-1

[6]: #feedevent

[7]: #properties-2

[8]: #transactionevent

[9]: #getreceivedatafromreceipt

[10]: #parameters

[11]: #userstorage

[12]: #parameters-1

[13]: #wallet

[14]: #gunuser

[15]: #profile

[16]: #feed

[17]: #feedindex

[18]: #user

[19]: #ready

[20]: #init

[21]: #getfeeditembytransactionhash

[22]: #parameters-2

[23]: #getallfeed

[24]: #updatefeedindex

[25]: #parameters-3

[26]: #initfeed

[27]: #getprofilefieldvalue

[28]: #parameters-4

[29]: #getprofilefield

[30]: #parameters-5

[31]: #getdisplayprofile

[32]: #parameters-6

[33]: #getprivateprofile

[34]: #parameters-7

[35]: #setprofile

[36]: #parameters-8

[37]: #setprofilefield

[38]: #parameters-9

[39]: #indexprofilefield

[40]: #parameters-10

[41]: #setprofilefieldprivacy

[42]: #parameters-11

[43]: #getfeedpage

[44]: #parameters-12

[45]: #getformattedevents

[46]: #parameters-13

[47]: #getuseraddress

[48]: #parameters-14

[49]: #getuserprofile

[50]: #parameters-15

[51]: #formatevent

[52]: #parameters-16

[53]: #enqueuetx

[54]: #parameters-17

[55]: #dequeuetx

[56]: #parameters-18

[57]: #peektx

[58]: #parameters-19

[59]: #updatefeedevent

[60]: #parameters-20

[61]: #getlastblocknode

[62]: #savelastblocknumber

[63]: #parameters-21

[64]: #deleteaccount

[65]: #maskfield

[66]: #parameters-22

[67]: #parameters-23

[68]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String

[69]: #fieldprivacy

[70]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object

[71]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array

[72]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Date

[73]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number

[74]: #gundbuser

[75]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise

[76]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean

[77]: #feedevent
## Source
[https://github.com/GoodDollar/GoodDAPP/src/lib/gundb/UserStorage.js](https://github.com/GoodDollar/GoodDAPP/src/lib/gundb/UserStorage.js)

